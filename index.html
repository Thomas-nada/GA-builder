<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Governance Action Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-orange: #d63f1e;
            --primary-blue: #0228aa;
            --text-color: #ffffff;
            --text-color-muted: #d1d5db; /* gray-300 */
            --bg-gradient-start: var(--primary-blue);
            --bg-gradient-end: #011a75;
            --card-bg-color: rgba(0, 0, 0, 0.2);
            --modal-bg-color: #01218f;
            --input-bg: rgba(2, 40, 170, 0.5);
            --border-color: rgba(255, 255, 255, 0.1);
            --header-bg: rgba(0,0,0,0.2);
            --guide-section-bg: rgba(0,0,0,0.15);
            --code-bg: rgba(0, 0, 0, 0.3);
            --code-color: #ffc2b3;
            --btn-secondary-bg: rgba(255, 255, 255, 0.1);
            --btn-secondary-hover-bg: rgba(255, 255, 255, 0.2);
        }

        body.light-mode {
            --text-color: #0228aa; /* Use primary blue for text */
            --text-color-muted: #4b5563; /* gray-600 */
            --bg-gradient-start: #f9fafb; /* gray-50 */
            --bg-gradient-end: #e5e7eb; /* gray-200 */
            --card-bg-color: rgba(255, 255, 255, 0.7);
            --modal-bg-color: #ffffff;
            --input-bg: #f3f4f6; /* gray-100 */
            --border-color: rgba(0, 0, 0, 0.1);
            --header-bg: rgba(255,255,255,0.7);
            --guide-section-bg: #ffffff;
            --code-bg: #e5e7eb;
            --code-color: #d63f1e;
            --btn-secondary-bg: rgba(0, 0, 0, 0.05);
            --btn-secondary-hover-bg: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
            color: var(--text-color);
        }

        .card-bg, .guide-section {
            background-color: var(--card-bg-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }
        .modal-bg {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: var(--modal-bg-color);
            color: var(--text-color);
        }
        body.light-mode .modal-content {
             color: var(--text-color);
        }
        body.light-mode .text-gray-300, body.light-mode .text-gray-400 {
            color: var(--text-color-muted);
        }
        body.light-mode .modal-content .text-gray-400 {
            color: #6b7280; /* gray-500 */
        }
        .btn-primary {
            background-color: var(--primary-orange);
            color: white;
        }
        .btn-primary:hover {
            background-color: #b83619; /* Darker orange for hover */
        }
        .btn-secondary {
            background-color: var(--btn-secondary-bg);
            border: 1px solid var(--border-color);
        }
        .btn-secondary:hover {
             background-color: var(--btn-secondary-hover-bg);
        }
        .text-accent {
            color: var(--primary-orange);
        }
        .focus-ring-accent:focus {
            --tw-ring-color: var(--primary-orange);
        }
        code {
            background-color: var(--code-bg);
            color: var(--code-color);
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-size: 0.9em;
            word-break: break-all;
        }
        .step-indicator {
            counter-reset: step;
        }
        .step-indicator .step {
            counter-increment: step;
        }
         .step-indicator .step:before {
            content: counter(step);
            display: flex;
            justify-content: center;
            align-items: center;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background-color: var(--primary-orange);
            color: white;
            font-weight: bold;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        .nav-link.active {
            background-color: var(--primary-orange);
            font-weight: 600;
            color: white;
        }
        .nav-link:not(.active):hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        body.light-mode .nav-link:not(.active):hover {
             background-color: rgba(0, 0, 0, 0.05);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        body.dark .accordion-content {
             background-color: rgba(0,0,0,0.2);
        }
        body.light-mode .accordion-content {
             background-color: rgba(255,255,255,0.5);
        }
        
        #page-guide h2 {
            font-size: 2.25rem;
            font-weight: 800;
            margin-bottom: 2rem;
            text-align: center;
        }
        #page-guide h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--primary-orange);
        }
        #page-guide p, #page-guide li {
            font-size: 1.1rem;
            line-height: 1.6;
        }
         #page-guide ul {
            list-style-type: disc;
            padding-left: 2rem;
            margin-bottom: 1rem;
         }
        #network-selector {
            background-color: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.2);
        }
        body.light-mode #network-selector {
             background-color: #f3f4f6;
             border: 1px solid #d1d5db;
        }
        header {
            transition: transform 0.3s ease-in-out;
            background-color: var(--header-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .header-hidden {
            transform: translateY(-100%);
        }
        .input-styled {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }
         body.light-mode .input-styled::placeholder {
            color: #9ca3af; /* gray-400 */
         }
         body.light-mode .modal-content label {
            color: var(--text-color);
         }
         body.light-mode .modal-content #guardrail-warning {
             color: #fbbf24; /* amber-400 */
         }
         .step-indicator .step:before {
            display: inline-flex;
        }
        .step {
            display: flex;
            align-items: flex-start;
        }
        .step > div:last-child {
            flex-grow: 1;
        }

    </style>
</head>
<body class="">

    <!-- Header -->
    <header id="main-header" class="sticky top-0 z-50 shadow-lg">
        <nav class="container mx-auto px-6 py-4 flex flex-col">
            <!-- Top row for desktop, stacks on mobile -->
            <div class="w-full flex flex-col items-center md:flex-row md:justify-between">
                <!-- Title: Always visible -->
                <a href="#" class="flex items-center space-x-4">
                    <div class="flex flex-col">
                        <span class="text-xl leading-tight">Governance Action</span>
                        <span class="text-xl leading-tight">Builder</span>
                    </div>
                </a>
                
                <!-- Controls: Stack below title on mobile, move to the right on desktop -->
                <div class="flex items-center space-x-4 mt-4 md:mt-0">
                     <select id="network-selector" class="rounded-lg px-2 py-1 text-sm focus:outline-none focus:ring-2 focus-ring-accent">
                         <option value="--mainnet">Mainnet</option>
                         <option value="--preprod-magic 1">PreProd</option>
                         <option value="--preview-magic 2">Preview</option>
                         <option value="--testnet-magic 4">SanchoNet</option>
                     </select>
                    <button id="theme-toggle" class="p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
                        <svg id="theme-icon-light" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-15.66l-.7.7M4.04 19.96l-.7.7M21 12h-1M4 12H3m15.66 8.66l-.7-.7M4.04 4.04l-.7-.7M12 18a6 6 0 100-12 6 6 0 000 12z"/></svg>
                        <svg id="theme-icon-dark" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                    </button>
                </div>
            </div>
            
            <!-- Bottom row (for navigation links), always centered -->
            <div class="w-full flex justify-center items-center space-x-2 mt-4">
                <button id="nav-build" class="nav-link active">Builder</button>
                <button id="nav-examples" class="nav-link">Examples</button>
                <button id="nav-guide" class="nav-link">Guide</button>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        <!-- Page: Build -->
        <div id="page-build" class="page-content">
            <section class="text-center pt-10 md:pt-20 pb-10">
                <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">Create On-Chain Governance Actions</h1>
                <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto">
                    A step-by-step tool to generate the metadata and transaction commands for Cardano governance actions.
                </p>
            </section>

            <section class="py-16">
                <h2 class="text-3xl font-bold text-center mb-12">Select a Governance Action to Begin</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card-bg rounded-xl p-6 flex flex-col hover:border-orange-400 transition-all duration-300">
                        <h3 class="text-xl font-bold mb-2">New Constitution</h3>
                        <p class="text-gray-300 mb-4 flex-grow">A fundamental action to amend the Cardano Constitution or its associated Guardrails Script, allowing the foundational rules of the ecosystem to evolve.</p>
                        <button class="create-proposal-btn btn-primary mt-auto w-full text-center py-2 rounded-lg font-semibold transition-colors" data-action-type="new-constitution" data-action-name="New Constitution">Create Proposal</button>
                    </div>
                    <div class="card-bg rounded-xl p-6 flex flex-col hover:border-orange-400 transition-all duration-300">
                        <h3 class="text-xl font-bold mb-2">Hard Fork Initiation</h3>
                        <p class="text-gray-300 mb-4 flex-grow">The most significant technical action, used to trigger a non-backwards-compatible upgrade of the entire Cardano protocol, introducing major new features.</p>
                        <button class="create-proposal-btn btn-primary mt-auto w-full text-center py-2 rounded-lg font-semibold transition-colors" data-action-type="hard-fork" data-action-name="Hard Fork Initiation">Create Proposal</button>
                    </div>
                    <div class="card-bg rounded-xl p-6 flex flex-col hover:border-orange-400 transition-all duration-300">
                        <h3 class="text-xl font-bold mb-2">Protocol Parameters</h3>
                        <p class="text-gray-300 mb-4 flex-grow">An action to fine-tune the network's operational settings, such as transaction fees, block size, or staking rewards, to adapt to changing conditions.</p>
                        <button class="create-proposal-btn btn-primary mt-auto w-full text-center py-2 rounded-lg font-semibold transition-colors" data-action-type="parameter-change" data-action-name="Protocol Parameter Change">Create Proposal</button>
                    </div>
                    <div class="card-bg rounded-xl p-6 flex flex-col hover:border-orange-400 transition-all duration-300">
                        <h3 class="text-xl font-bold mb-2">Treasury Withdrawals</h3>
                        <p class="text-gray-300 mb-4 flex-grow">An action to request funds from the community-managed Cardano treasury to finance projects and initiatives that benefit the ecosystem.</p>
                        <button class="create-proposal-btn btn-primary mt-auto w-full text-center py-2 rounded-lg font-semibold transition-colors" data-action-type="treasury-withdrawal" data-action-name="Treasury Withdrawal">Create Proposal</button>
                    </div>
                    <div class="card-bg rounded-xl p-6 flex flex-col hover:border-orange-400 transition-all duration-300">
                        <h3 class="text-xl font-bold mb-2">Motion of No-Confidence</h3>
                        <p class="text-gray-300 mb-4 flex-grow">Triggers a 'state of no confidence' in the current Constitutional Committee. For governance to return to a fully operational state, a new committee must be ratified through a subsequent 'Update Committee / Threshold' action.</p>
                        <button class="create-proposal-btn btn-primary mt-auto w-full text-center py-2 rounded-lg font-semibold transition-colors" data-action-type="no-confidence" data-action-name="Motion of No-Confidence">Create Proposal</button>
                    </div>
                    <div class="card-bg rounded-xl p-6 flex flex-col hover:border-orange-400 transition-all duration-300">
                        <h3 class="text-xl font-bold mb-2">Update Committee / Threshold</h3>
                        <p class="text-gray-300 mb-4 flex-grow">An action to change the composition of the Constitutional Committee, its members' term limits, or the voting threshold required for its decisions. Also used to elect a new committee after a 'Motion of No-Confidence'.</p>
                         <button class="create-proposal-btn btn-primary mt-auto w-full text-center py-2 rounded-lg font-semibold transition-colors" data-action-type="update-committee" data-action-name="Update Committee / Threshold">Create Proposal</button>
                    </div>
                    <div class="card-bg rounded-xl p-6 flex flex-col hover:border-orange-400 transition-all duration-300">
                        <h3 class="text-xl font-bold mb-2">Info Action</h3>
                        <p class="text-gray-300 mb-4 flex-grow">A non-binding action with no direct on-chain effect. It is used to gauge community sentiment, conduct polls, or signal intent for future proposals, including proposing budgets or treasury limits.</p>
                         <button class="create-proposal-btn btn-primary mt-auto w-full text-center py-2 rounded-lg font-semibold transition-colors" data-action-type="info" data-action-name="Info Action">Create Proposal</button>
                    </div>
                </div>
            </section>
        </div>
        
        <!-- Page: Examples -->
        <div id="page-examples" class="page-content hidden">
            <section class="text-center pt-10 md:pt-20 pb-10">
                <h1 class="text-4xl md:text-5xl font-extrabold mb-4 leading-tight">Governance Action Examples</h1>
                <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto">
                    Complete transaction examples for each governance action type. Click any action to expand and see the details.
                </p>
            </section>

            <section id="examples-accordion" class="max-w-4xl mx-auto space-y-4">
                <!-- Examples will be injected here by JS -->
            </section>
        </div>

        <!-- Page: Guide -->
        <div id="page-guide" class="page-content hidden">
            <div class="max-w-4xl mx-auto pt-10 md:pt-20 pb-10 space-y-8">
                 <h2>A Guide to Cardano Governance Actions</h2>
                 <div class="card-bg rounded-xl p-6 md:p-8">
                    <h3>An Introduction to Governance Actions</h3>
                    <p>A governance action is a formal proposal submitted on the Cardano blockchain to make a change or signal an intent. It is the fundamental mechanism through which the Cardano community can collectively decide on the future of the network. This on-chain system ensures that all decisions are transparent, auditable, and driven by stakeholder consensus.</p>
                </div>

                 <div class="card-bg rounded-xl p-6 md:p-8">
                    <h3>Key Things to Know Before Submitting</h3>
                    <ul>
                        <li><strong>Who Votes?</strong> Voting power is distributed among three groups: Delegated Representatives (DReps), Stake Pool Operators (SPOs), and the Constitutional Committee (CC). The specific group(s) required to vote depends on the type of action proposed.</li>
                        <li><strong>How much does it cost?</strong> Submitting a governance action requires a deposit in Ada, which is returned to you when the action is finalized (either enacted or rejected). The current deposit amount is set by a protocol parameter (currently 100 000 Ada) and is intended to prevent spam.</li>
                        <li><strong>How long does voting last?</strong> The voting period is tied to Cardano's epoch system. Once an action is submitted, it enters a ratification phase where it can be voted upon. This period typically lasts for a set number of epochs (currently 6 epochs for all governance action types), giving the community ample time to review, debate, and cast their votes.</li>
                    </ul>
                </div>

                 <div class="card-bg rounded-xl p-6 md:p-8">
                    <h3>How to Write a High-Quality Proposal</h3>
                    <p>A well-written proposal is crucial for gaining community support. The metadata you generate with this tool is your chance to convince stakeholders to vote 'Yes'. Your goal should be clarity, transparency, and a compelling argument.</p>
                    
                    <h3 class="mt-8">The Anatomy of a Proposal (CIP-108)</h3>
                    <p>Your proposal metadata should contain the following four key fields:</p>
                    <ul>
                        <li><strong>Title:</strong> A clear, concise, and descriptive title. It should immediately tell voters what the proposal is about. (Max 80 characters)</li>
                        <li><strong>Abstract:</strong> A short summary (2-3 sentences) of the proposal. This is the "elevator pitch" that should grab the reader's attention and make them want to learn more.</li>
                        <li><strong>Motivation:</strong> Explain the "why" behind your proposal. What problem are you trying to solve? What opportunity are you trying to seize? Provide context and evidence to support your claims.</li>
                        <li><strong>Rationale:</strong> This is the "how". Detail your proposed solution and explain why it's the best approach. Break down the implementation plan, discuss the potential impact, and address any risks or trade-offs. Be as specific and transparent as possible.</li>
                    </ul>
                </div>

                 <div class="card-bg rounded-xl p-6 md:p-8">
                    <h3>Best Practices for Success</h3>
                    <ul>
                        <li><strong>Engage the Community First:</strong> Before submitting on-chain, discuss your idea on platforms like the Cardano Forum, Discord, or X/Twitter. Gather feedback, refine your proposal, and build consensus.</li>
                        <li><strong>Be Specific and Data-Driven:</strong> Avoid vague statements. Use data, evidence, and clear metrics to support your motivation and rationale. If requesting treasury funds, provide a detailed budget.</li>
                        <li><strong>Reference Existing Work:</strong> If your proposal relates to a Cardano Improvement Proposal (CIP), a prior community discussion, or a specific research paper, link to it in the `references` section of your metadata. This shows you've done your homework.</li>
                        <li><strong>Keep it Professional:</strong> Use clear, professional language. Avoid hype, personal attacks, or overly technical jargon where simpler terms would suffice.</li>
                        <li><strong>Proofread Thoroughly:</strong> A proposal with typos and grammatical errors can appear unprofessional and may deter support. Read it over carefully before generating the final JSON.</li>
                    </ul>
                </div>

            </div>
        </div>
    </main>

    <!-- Main Modal Structure -->
    <div id="proposal-modal" class="hidden fixed inset-0 z-50 overflow-y-auto modal-bg flex items-center justify-center p-4">
        <div class="modal-content rounded-xl shadow-2xl w-full max-w-4xl max-h-full overflow-y-auto">
            <div class="p-6 md:p-8">
                <!-- Modal Header -->
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 id="modal-title" class="text-2xl font-bold"></h2>
                        <p class="text-gray-400">Follow the steps below to build your proposal.</p>
                    </div>
                    <button id="close-modal-btn" class="text-gray-300 hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div id="modal-body" class="space-y-8">
                    <!-- This will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Disclaimer Modal Structure -->
    <div id="disclaimer-modal" class="hidden fixed inset-0 z-[60] overflow-y-auto modal-bg flex items-center justify-center p-4">
        <div class="modal-content rounded-xl shadow-2xl w-full max-w-lg">
             <div class="p-6 md:p-8">
                 <h3 class="text-xl font-bold mb-4">Disclaimer</h3>
                 <p class="mb-6 text-base">You are responsible to verify the accuracy of the transaction details yourself. I am not responsible for any inaccuracies caused by your stupidity, mistakes in the app or user error.</p>
                 <div class="flex justify-end space-x-4">
                     <button id="disclaimer-cancel-btn" class="btn-secondary px-4 py-2 rounded-lg font-semibold">Cancel</button>
                     <button id="disclaimer-agree-btn" class="btn-primary px-4 py-2 rounded-lg font-semibold">I Agree</button>
                 </div>
            </div>
        </div>
    </div>


    <footer class="bg-black/20 border-t border-white/10 mt-20">
        <div class="container mx-auto px-6 py-8 text-center text-gray-400 text-sm">
            <p class="mb-4">Built by <a href="https://x.com/ThomasNordicADA" target="_blank" class="text-orange-400 hover:underline">Thomas Lindseth</a> under harassment by <a href="https://x.com/Hornan7" target="_blank" class="text-orange-400 hover:underline">Mike Hornan</a>.</p>
            <p class="mt-2">Licensed under the Apache License, Version 2.0 (the "License");</p>
            <p>you may not use this file except in compliance with the License.</p>
            <p>You may obtain a copy of the License at <a href="http://www.apache.org/licenses/LICENSE-2.0" class="text-orange-400 hover:underline" target="_blank">http://www.apache.org/licenses/LICENSE-2.0</a></p>
        </div>
    </footer>

    <script>
        // --- DATA ---
        const examplesData = {
            'New Constitution': {
              metadata: `{
  "body": {
    "title": "Adoption of the Genesis Constitution",
    "abstract": "This proposal enacts the first official version of the Cardano Constitution, establishing the foundational principles and governance framework for the ecosystem.",
    "motivation": "A formal constitution is necessary to provide a clear, stable, and legitimate framework for on-chain governance, ensuring that all future decisions align with the core values of the community.",
    "rationale": "This initial version has been drafted through extensive community consultation and feedback. Its adoption marks a pivotal step towards a fully decentralized and self-sustaining governance model as envisioned in the roadmap.",
    "references": []
  },
  "authors": [],
  "hashAlgorithm": "blake2b-256"
}`,
              action: `cardano-cli conway governance action create-constitution \\
  ##NETWORK## \\
  --governance-action-deposit 1000000000 \\
  --deposit-return-stake-verification-key-file path/to/stake.vkey \\
  --anchor-url https://ipfs.io/ipfs/QmConstitutionMeta... \\
  --anchor-data-hash c12... \\
  --constitution-url https://ipfs.io/ipfs/QmConstitutionText... \\
  --constitution-hash 9a2... \\
  --guardrails-script-hash 5908545908510101003232323232323232323232323232323232323232323232323232323232323232323232323232323232259323255333573466e1d20000011180098111bab357426ae88d55cf00104554ccd5cd19b87480100044600422c6aae74004dd51aba1357446ae88d55cf1baa3255333573466e1d200a35573a002226ae84d5d11aab9e00111637546ae84d5d11aba235573c6ea800642b26006003149a2c8a4c301f801c0052000c00e0070018016006901e4070c00e003000c00d20d00fc000c0003003800a4005801c00e003002c00d20c09a0c80e1801c006001801a4101b5881380018000600700148013003801c006005801a410100078001801c006001801a4101001f8001800060070014801b0038018096007001800600690404002600060001801c0052008c00e006025801c006001801a41209d8001800060070014802b003801c006005801a410112f501c3003800c00300348202b7881300030000c00e00290066007003800c00b003482032ad7b806038403060070014803b00380180960003003800a4021801c00e003002c00d20f40380e1801c006001801a41403f800100a0c00e0029009600f0030078040c00e002900a600f003800c00b003301a483403e01a600700180060066034904801e00060001801c0052016c01e00600f801c006001801980c2402900e30000c00e002901060070030128060c00e00290116007003800c00b003483c0ba03860070018006006906432e00040283003800a40498003003800a404d802c00e00f003800c00b003301a480cb0003003800c003003301a4802b00030001801c01e0070018016006603490605c016000600700180060066034904827600060030000c00e0029014600b003801c00c04b003800c00300348203a2489b00030001801c00e006025801c006001801a4101b11dc2df80018000c0003003800a4055802c00e007003012c00e003000c00d2080b8b872c000c0006007003801809600700180060069040607e4155016000600030000c00e00290166007003012c00e003000c00d2080c001c000c0003003800a405d801c00e003002c00d20c80180e1801c006001801a412007800100a0c00e00290186007003013c0006007001480cb005801801e006003801800e00600500403003800a4069802c00c00f003001c00c007003803c00e003002c00c05300333023480692028c0004014c00c00b003003c00c00f003003c00e00f003800c00b00301480590052008003003800a406d801c00e003002c00d2000c00d2006c00060070018006006900a600060001801c0052038c00e007001801600690006006901260003003800c003003483281300020141801c005203ac00e006027801c006001801a403d800180006007001480f3003801804e00700180060069040404af3c4e302600060001801c005203ec00e006013801c006001801a4101416f0fd20b80018000600700148103003801c006005801a403501c3003800c0030034812b00030000c00e0029021600f003800c00a01ac00e003000c00ccc08d20d00f4800b00030000c0000000000803c00c016008401e006009801c006001801807e0060298000c000401e006007801c0060018018074020c000400e00f003800c00b003010c000802180020070018006006019801805e0003000400600580180760060138000800c00b00330134805200c400e00300080330004006005801a4001801a410112f58000801c00600901260008019806a40118002007001800600690404a75ee01e00060008018046000801801e000300c4832004c025201430094800a0030028052003002c00d2002c000300648010c0092002300748028c0312000300b48018c0292012300948008c0212066801a40018000c0192008300a2233335573e00250002801994004d55ce800cd55cf0008d5d08014c00cd5d10011263009222532900389800a4d2219002912c80344c01526910c80148964cc04cdd68010034564cc03801400626601800e0071801226601800e01518010096400a3000910c008600444002600244004a664600200244246466004460044460040064600444600200646a660080080066a00600224446600644b20051800484ccc02600244666ae68cdc3801000c00200500a91199ab9a33710004003000801488ccd5cd19b89002001800400a44666ae68cdc4801000c00a00122333573466e20008006005000912a999ab9a3371200400222002220052255333573466e2400800444008440040026eb400a42660080026eb000a4264666015001229002914801c8954ccd5cd19b8700400211333573466e1c00c006001002118011229002914801c88cc044cdc100200099b82002003245200522900391199ab9a3371066e08010004cdc1001001c002004403245200522900391199ab9a3371266e08010004cdc1001001c00a00048a400a45200722333573466e20cdc100200099b820020038014000912c99807001000c40062004912c99807001000c400a2002001199919ab9a357466ae880048cc028dd69aba1003375a6ae84008d5d1000934000dd60010a40064666ae68d5d1800c0020052225933006003357420031330050023574400318010600a444aa666ae68cdc3a400000222c22aa666ae68cdc4000a4000226600666e05200000233702900000088994004cdc2001800ccdc20010008cc010008004c01088954ccd5cd19b87480000044400844cc00c004cdc300100091119803112c800c60012219002911919806912c800c4c02401a442b26600a004019130040018c008002590028c804c8888888800d1900991111111002a244b267201722222222008001000c600518000001112a999ab9a3370e004002230001155333573466e240080044600823002229002914801c88ccd5cd19b893370400800266e0800800e00100208c8c0040048c0088cc008008005 \\
  --out-file constitution.action`,
              build: `cardano-cli conway transaction build \\
  ##NETWORK## \\
  --tx-in 861...#0 \\
  --change-address addr1... \\
  --proposal-file constitution.action \\
  --out-file tx.raw`,
              sign: `cardano-cli conway transaction sign \\
  --tx-body-file tx.raw \\
  --signing-key-file path/to/payment.skey \\
  --signing-key-file path/to/drep.skey \\
  ##NETWORK## \\
  --out-file tx.signed`,
              submit: `cardano-cli conway transaction submit \\
  ##NETWORK## \\
  --tx-file tx.signed`
            },
            'Hard Fork Initiation': {
                metadata: `{
  "body": {
    "title": "Initiate Hard Fork for Protocol Version 10.0",
    "abstract": "Proposal to trigger a hard fork to upgrade the Cardano protocol to version 10.0, enabling new functionalities such as 'Proof-of-Stake v.2'.",
    "motivation": "The upcoming protocol enhancements are critical for improving network scalability, security, and interoperability. This hard fork is a necessary step to deploy these long-planned upgrades.",
    "rationale": "All core node software, wallets, and explorers have been updated and tested extensively on the preview testnet. The ecosystem is prepared for this transition. This action formally schedules the upgrade.",
    "references": []
  },
  "authors": [],
  "hashAlgorithm": "blake2b-256"
}`,
                action: `cardano-cli conway governance action create-hard-fork \\
  ##NETWORK## \\
  --prev-gov-action-tx-id b48... --prev-gov-action-ix 1 \\
  --governance-action-deposit 1000000000 \\
  --deposit-return-stake-verification-key-file path/to/stake.vkey \\
  --anchor-url https://ipfs.io/ipfs/QmHardFork... \\
  --anchor-data-hash 1c8... \\
  --protocol-major-version 10 \\
  --protocol-minor-version 0 \\
  --out-file hardfork.action`,
                build: `...`,
                sign: `...`,
                submit: `...`
            },
            'Protocol Parameters': {
                metadata: `...`,
                action: `cardano-cli conway governance action create-protocol-parameters-update \\
  ##NETWORK## \\
  --prev-gov-action-tx-id b48... --prev-gov-action-ix 1 \\
  --governance-action-deposit 1000000000 \\
  --deposit-return-stake-verification-key-file path/to/stake.vkey \\
  --anchor-url https://ipfs.io/ipfs/QmParams... \\
  --anchor-data-hash 3b5... \\
  --min-fee-b 150000 \\
  --out-file params.action`,
                build: `...`,
                sign: `...`,
                submit: `...`
            },
            'Treasury Withdrawal': {
                metadata: `{
  "body": {
    "title": "Funding for Open-Source Staking Analytics Dashboard",
    "abstract": "Proposal to withdraw 50,000 ADA from the treasury to fund the development of an open-source staking analytics dashboard.",
    "motivation": "The ecosystem lacks a comprehensive, free staking analytics tool. This will provide valuable insights to SPOs and delegators, improving transparency.",
    "rationale": "Funds cover 6 months of development. A detailed budget and roadmap are at the reference link.",
    "references": [{"@type": "CIP100:OtherReference", "label": "Project Proposal", "uri": "https://docs.project.io/proposal"}]
  },
  "authors": [], "hashAlgorithm": "blake2b-256"
}`,
                action: `cardano-cli conway governance action create-treasury-withdrawal \\
  ##NETWORK## \\
  --governance-action-deposit 1000000000 \\
  --deposit-return-stake-verification-key-file path/to/stake.vkey \\
  --withdrawal "addr_test1...#50000000000" \\
  --anchor-url https://ipfs.io/ipfs/QmW... \\
  --anchor-data-hash 7a2... \\
  --out-file treasury.action`,
                build: `...`,
                sign: `...`,
                submit: `...`
            },
            'Motion of No-Confidence': {
                metadata: `{
  "body": {
    "title": "Motion of No-Confidence in the Current Constitutional Committee",
    "abstract": "This proposal declares a state of no-confidence in the sitting Constitutional Committee due to prolonged inactivity and failure to ratify critical proposals.",
    "motivation": "The Committee's role is vital for governance. Their recent lack of engagement has created a bottleneck, stalling progress. This motion is a necessary step to restore functionality.",
    "rationale": "Data from the last three epochs shows a consistent failure to meet the required ratification threshold on any proposal. This motion allows the community to elect a new, more active committee.",
    "references": []
  },
  "authors": [], "hashAlgorithm": "blake2b-256"
}`,
                action: `cardano-cli conway governance action create-no-confidence \\
  ##NETWORK## \\
  --prev-gov-action-tx-id a12... --prev-gov-action-ix 0 \\
  --governance-action-deposit 1000000000 \\
  --deposit-return-stake-verification-key-file path/to/stake.vkey \\
  --anchor-url https://ipfs.io/ipfs/QmNoConfidence... \\
  --anchor-data-hash 9f1... \\
  --out-file noconfidence.action`,
                build: `...`,
                sign: `...`,
                submit: `...`
            },
            'Update Committee / Threshold': {
                metadata: `...`,
                action: `cardano-cli conway governance action create-update-committee \\
  ##NETWORK## \\
  --prev-gov-action-tx-id f4c... --prev-gov-action-ix 0 \\
  --governance-action-deposit 1000000000 \\
  --deposit-return-stake-verification-key-file path/to/stake.vkey \\
  --anchor-url https://ipfs.io/ipfs/QmCommittee... \\
  --anchor-data-hash 8e3... \\
  --add-committee-member-cold-verification-key-file path/to/cc_member3.vkey --epoch 950 \\
  --remove-committee-member-cold-verification-key-file path/to/cc_member1.vkey \\
  --new-threshold 0.66 \\
  --out-file committee.action`,
                build: `...`,
                sign: `...`,
                submit: `...`
            },
            'Info Action': {
                metadata: `{
  "body": {
    "title": "Community Poll: Prioritize Development Grant Focus Areas",
    "abstract": "This is a non-binding poll to gauge community sentiment on which areas should be prioritized for the next round of development grants.",
    "motivation": "To ensure that treasury funds are allocated in a way that reflects the community's collective priorities and vision for Cardano's growth.",
    "rationale": "By conducting this poll, we can gather valuable data to inform grant-giving entities and ensure a more transparent and community-aligned allocation process.",
    "references": []
  },
  "authors": [], "hashAlgorithm": "blake2b-256"
}`,
                action: `cardano-cli conway governance action create-info \\
  ##NETWORK## \\
  --governance-action-deposit 1000000000 \\
  --deposit-return-stake-verification-key-file path/to/stake.vkey \\
  --anchor-url https://ipfs.io/ipfs/QmW... \\
  --anchor-data-hash 4f8... \\
  --out-file info.action`,
                build: `...`,
                sign: `...`,
                submit: `...`
            }
        };


        // --- UTILITY FUNCTIONS ---
        const copyToClipboard = (text, button) => {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
             try {
                 document.execCommand('copy');
                 const originalText = button.innerHTML;
                 button.innerHTML = 'Copied!';
                 setTimeout(() => { button.innerHTML = originalText; }, 2000);
             } catch (err) {
                 console.error('Failed to copy text: ', err);
                 // Fallback for browsers that don't support execCommand
                 navigator.clipboard.writeText(text).then(() => {
                     const originalText = button.innerHTML;
                     button.innerHTML = 'Copied!';
                     setTimeout(() => { button.innerHTML = originalText; }, 2000);
                 }).catch(err => {
                     console.error('Fallback copy failed', err);
                 });
             }
            document.body.removeChild(textarea);
        };
        
        // --- PAGE NAVIGATION ---
        const navBuildBtn = document.getElementById('nav-build');
        const navExamplesBtn = document.getElementById('nav-examples');
        const navGuideBtn = document.getElementById('nav-guide');
        const pageBuild = document.getElementById('page-build');
        const pageExamples = document.getElementById('page-examples');
        const pageGuide = document.getElementById('page-guide');
        const networkSelector = document.getElementById('network-selector');

        let currentNetwork = '--mainnet';
        networkSelector.addEventListener('change', (e) => {
            currentNetwork = e.target.value;
            // Re-render examples if the page is visible
            if (!pageExamples.classList.contains('hidden')) {
                renderExamples();
            }
        });

        const navigateTo = (page) => {
            pageBuild.classList.add('hidden');
            pageExamples.classList.add('hidden');
            pageGuide.classList.add('hidden');
            navBuildBtn.classList.remove('active');
            navExamplesBtn.classList.remove('active');
            navGuideBtn.classList.remove('active');

            if (page === 'build') {
                pageBuild.classList.remove('hidden');
                navBuildBtn.classList.add('active');
            } else if (page === 'examples') {
                pageExamples.classList.remove('hidden');
                navExamplesBtn.classList.add('active');
                renderExamples();
            } else if (page === 'guide') {
                pageGuide.classList.remove('hidden');
                navGuideBtn.classList.add('active');
            }
        };

        navBuildBtn.addEventListener('click', () => navigateTo('build'));
        navExamplesBtn.addEventListener('click', () => navigateTo('examples'));
        navGuideBtn.addEventListener('click', () => navigateTo('guide'));


        // --- MODAL AND BUILDER LOGIC ---
        const proposalModal = document.getElementById('proposal-modal');
        const disclaimerModal = document.getElementById('disclaimer-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const createProposalButtons = document.querySelectorAll('.create-proposal-btn');
        const closeModalButton = document.getElementById('close-modal-btn');
        const disclaimerAgreeBtn = document.getElementById('disclaimer-agree-btn');
        const disclaimerCancelBtn = document.getElementById('disclaimer-cancel-btn');
        
        let currentActionType = '';

        const getFormValues = (formId) => {
            const form = document.getElementById(formId);
            if (!form) return {};
            const formData = new FormData(form);
            const values = {};
            for (let [key, value] of formData.entries()) {
                values[key] = value;
            }
            return values;
        };
        
        const generateMetadata = () => {
            const { title, abstract, motivation, rationale, references } = getFormValues('metadata-form');
            const metadata = {
              "@context": {
                "@language": "en-us",
                "CIP100": "https://github.com/cardano-foundation/CIPs/blob/master/CIP-0100/README.md#",
                "CIP108": "https://github.com/cardano-foundation/CIPs/blob/master/CIP-0108/README.md#",
                "hashAlgorithm": "CIP100:hashAlgorithm",
                "body": {
                  "@id": "CIP108:body",
                  "@context": {
                    "references": {
                      "@id": "CIP108:references",
                      "@container": "@set",
                      "@context": {
                        "GovernanceMetadata": "CIP100:GovernanceMetadataReference",
                        "Other": "CIP100:OtherReference",
                        "label": "CIP100:reference-label",
                        "uri": "CIP100:reference-uri",
                        "referenceHash": {
                          "@id": "CIP108:referenceHash",
                          "@context": {
                            "hashDigest": "CIP108:hashDigest",
                            "hashAlgorithm": "CIP100:hashAlgorithm"
                          }
                        }
                      }
                    },
                    "title": "CIP108:title",
                    "abstract": "CIP108:abstract",
                    "motivation": "CIP108:motivation",
                    "rationale": "CIP108:rationale"
                  }
                },
                "authors": {
                  "@id": "CIP100:authors",
                  "@container": "@set",
                  "@context": {
                    "name": "http://xmlns.com/foaf/0.1/name",
                    "witness": {
                      "@id": "CIP100:witness",
                      "@context": {
                        "witnessAlgorithm": "CIP100:witnessAlgorithm",
                        "publicKey": "CIP100:publicKey",
                        "signature": "CIP100:signature"
                      }
                    }
                  }
                }
              },
              "authors": [],
              "hashAlgorithm": "blake2b-256",
              "body": {
                "title": title || "Title Not Provided",
                "abstract": abstract || "Abstract Not Provided",
                "motivation": motivation || "Motivation Not Provided",
                "rationale": rationale || "Rationale Not Provided",
                "references": references ? [{
                    "@type": "CIP100:OtherReference",
                    "label": "Supporting Document",
                    "uri": references
                }] : []
              }
            };
            
            const metadataString = JSON.stringify(metadata, null, 2);
            const outputContainer = document.getElementById('metadata-output-container');
            const outputElem = outputContainer.querySelector('code');
            outputElem.textContent = metadataString;
            outputContainer.classList.remove('hidden');
            
            const downloadBtn = document.getElementById('download-json-btn');
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(metadataString);
            downloadBtn.setAttribute("href", dataStr);
            downloadBtn.classList.remove('hidden');
        };

        const buildTransaction = () => {
            const form = document.getElementById('transaction-form');
            if (!form) return;
            const formData = new FormData(form);
            const formValues = Object.fromEntries(formData.entries());
            const { metadataUrl, depositAddress, prevGovActionId, ...specificParams } = formValues;

            if (!metadataUrl || !depositAddress) {
                // A non-blocking notification would be better here.
                console.warn('Please provide a Metadata URL and a Deposit Return Address (stake key file name).');
                return;
            }
            
            let command = `cardano-cli conway governance action`;
            
            switch (currentActionType) {
                case 'no-confidence':
                    command += ` create-no-confidence`;
                    if (prevGovActionId) command += ` \\\n  --prev-gov-action-tx-id ${prevGovActionId.split('#')[0]} --prev-gov-action-ix ${prevGovActionId.split('#')[1] || '0'}`;
                    break;
                case 'update-committee':
                    command += ` create-update-committee`;
                    if (prevGovActionId) command += ` \\\n  --prev-gov-action-tx-id ${prevGovActionId.split('#')[0]} --prev-gov-action-ix ${prevGovActionId.split('#')[1] || '0'}`;
                    
                    document.querySelectorAll('#remove-members-container .dynamic-row').forEach(el => {
                        const vkey = el.querySelector('input[name="removeMemberVkey"]').value;
                        if (vkey) {
                            command += ` \\\n  --remove-committee-member-cold-verification-key-file path/to/${vkey}.vkey`;
                        }
                    });

                    document.querySelectorAll('#add-members-container .dynamic-row').forEach(el => {
                        const vkey = el.querySelector('input[name="addMemberVkey"]').value;
                        const epoch = el.querySelector('input[name="addMemberEpoch"]').value;
                        if (vkey && epoch) {
                            command += ` \\\n  --add-committee-member-cold-verification-key-file path/to/${vkey}.vkey --epoch ${epoch}`;
                        }
                    });

                    if(specificParams.newThreshold) command += ` \\\n  --new-threshold ${specificParams.newThreshold}`;
                    break;
                case 'new-constitution':
                    if (!specificParams.constitutionUrl || !specificParams.constitutionFile) {
                        console.warn('For a New Constitution, the Constitution URL and local file path are required.');
                        return;
                    }
                    command += ` create-constitution`;
                    if (prevGovActionId) command += ` \\\n  --prev-gov-action-tx-id ${prevGovActionId.split('#')[0]} --prev-gov-action-ix ${prevGovActionId.split('#')[1] || '0'}`;
                    command += ` \\\n  --constitution-url ${specificParams.constitutionUrl} --constitution-hash $(cardano-cli conway governance hash --file-text ${specificParams.constitutionFile})`;
                    
                    if (specificParams.guardrailScriptHash) {
                        command += ` \\\n  --guardrails-script-hash ${specificParams.guardrailScriptHash}`;
                    }
                    break;
                case 'hard-fork':
                    command += ` create-hard-fork`;
                    if (prevGovActionId) command += ` \\\n  --prev-gov-action-tx-id ${prevGovActionId.split('#')[0]} --prev-gov-action-ix ${prevGovActionId.split('#')[1] || '0'}`;
                    command += ` \\\n  --protocol-major-version ${specificParams.majorVer} --protocol-minor-version ${specificParams.minorVer}`;
                    break;
                case 'parameter-change':
                    command += ` create-protocol-parameters-update`;
                    if (prevGovActionId) command += ` \\\n  --prev-gov-action-tx-id ${prevGovActionId.split('#')[0]} --prev-gov-action-ix ${prevGovActionId.split('#')[1] || '0'}`;
                    if(specificParams.paramKey && specificParams.paramValue) command += ` \\\n  --${specificParams.paramKey} ${specificParams.paramValue}`;
                    break;
                case 'treasury-withdrawal':
                    command += ` create-treasury-withdrawal`;
                    document.querySelectorAll('.withdrawal-recipient').forEach((el, index) => {
                        const addr = el.querySelector(`input[name='recipientAddr${index+1}']`).value;
                        const amount = el.querySelector(`input[name='recipientAmount${index+1}']`).value;
                        if(addr && amount) {
                            command += ` \\\n  --withdrawal "${addr}#${amount * 1000000}"`; // Convert ADA to Lovelace
                        }
                    });
                    break;
                case 'info':
                    command += ` create-info`;
                    break;
            }
            
            command += ` \\\n  ${currentNetwork}`;
            command += ` \\\n  --governance-action-deposit 100000`; 
            command += ` \\\n  --deposit-return-stake-verification-key-file path/to/${depositAddress}.skey`;
            command += ` \\\n  --anchor-url ${metadataUrl}`;
            command += ` \\\n  --anchor-data-hash $(cardano-cli conway governance hash --url ${metadataUrl})`;
            command += ` \\\n  --out-file ${currentActionType}.action`;

            const outputElem = document.getElementById('transaction-output');
            outputElem.textContent = command;
            document.getElementById('transaction-output-container').classList.remove('hidden');
        };

        const getStep1HTML = () => `<div id="step-1" class="step pb-12"><div><h3 class="text-xl font-semibold mb-4">Create Proposal Metadata</h3><form id="metadata-form" class="space-y-4"><input type="text" name="title" class="w-full input-styled rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus-ring-accent" placeholder="Proposal Title (max 80 chars)"><textarea name="abstract" rows="3" class="w-full input-styled rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus-ring-accent" placeholder="Abstract..."></textarea><textarea name="motivation" rows="4" class="w-full input-styled rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus-ring-accent" placeholder="Motivation..."></textarea><textarea name="rationale" rows="4" class="w-full input-styled rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus-ring-accent" placeholder="Rationale..."></textarea><input type="url" name="references" class="w-full input-styled rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus-ring-accent" placeholder="Optional: URL to supporting document"><button type="button" id="generate-metadata-btn" class="btn-primary w-full font-bold py-2 px-4 rounded-lg transition-colors">Generate Metadata JSON</button></form><div id="metadata-output-container" class="hidden mt-4"><div class="relative p-4 rounded-lg" style="background-color: var(--code-bg);"><div class="absolute top-2 right-2 flex space-x-2"><a id="download-json-btn" href="#" download="metadata.json" class="hidden bg-green-600 hover:bg-green-500 text-xs px-2 py-1 rounded text-white font-semibold">Download</a><button class="copy-btn bg-gray-700 hover:bg-gray-600 text-xs px-2 py-1 rounded font-semibold text-white">Copy</button></div><pre><code class="language-json"></code></pre></div></div></div></div>`;
        const getStep2HTML = () => `<div id="step-2" class="step pb-12"><div><h3 class="text-xl font-semibold mb-4">Host Metadata on IPFS</h3><div class="input-styled rounded-lg px-4 py-3 space-y-3"><p>You must now host the generated JSON file on an immutable file storage service like IPFS.</p><ol class="list-decimal list-inside space-y-2"><li>Copy the JSON from Step 1 and save it as a file (e.g., <code>metadata.json</code>).</li><li>Upload this file to an IPFS provider.</li><li>Once uploaded, you will get a URL. You will need this for the next step.</li></ol><p class="font-semibold">Recommended IPFS Web Uploaders:</p><div class="flex space-x-4"><a href="https://web3.storage/" target="_blank" class="text-orange-400 hover:underline">web3.storage</a><a href="https://nft.storage/" target="_blank" class="text-orange-400 hover:underline">NFT.storage</a><a href="https://infura.io/product/ipfs" target="_blank" class="text-orange-400 hover:underline">Infura IPFS</a></div></div></div></div>`;
        const getStep3HTML = (actionType) => { let specificFields = ''; const inputClasses = "w-full input-styled rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus-ring-accent"; switch (actionType) { case 'update-committee': specificFields = `<div class="space-y-4"><div><h4 class="text-md font-semibold mb-2">Members to Remove</h4><div id="remove-members-container" class="space-y-2"></div><button type="button" id="add-remove-member-btn" class="mt-2 text-sm text-orange-400 hover:underline">+ Add member to remove</button></div><hr class="border-white/10"><div><h4 class="text-md font-semibold mb-2">Members to Add</h4><div id="add-members-container" class="space-y-2"></div><button type="button" id="add-add-member-btn" class="mt-2 text-sm text-orange-400 hover:underline">+ Add member to add</button></div><hr class="border-white/10"><div><h4 class="text-md font-semibold mb-2">New Threshold</h4><input type="text" name="newThreshold" class="${inputClasses}" placeholder="New Threshold (e.g., 0.6)"></div></div>`; break; case 'new-constitution': specificFields = `<div class="space-y-4"> <input type="url" name="constitutionUrl" required class="${inputClasses}" placeholder="URL of new constitution text"><input type="text" name="constitutionFile" required class="${inputClasses}" placeholder="Local path to constitution file (for hashing)"> <div class="space-y-2 pt-2"> <h4 class="text-md font-semibold">Guardrail Script Hash (Optional)</h4> <p class="text-sm text-gray-400">To generate the hash, run: <code class="text-xs">cardano-cli conway governance hash --script-file &lt;file_name&gt;</code></p> <input type="text" id="guardrailScriptHash-input" name="guardrailScriptHash" class="${inputClasses}" placeholder="Paste Guardrail Script Hash here"> <div class="flex items-center"> <input id="guardrail-empty" name="guardrailEmpty" type="checkbox" value="empty" class="h-4 w-4 border-gray-300 text-orange-600 focus:ring-orange-500"> <label for="guardrail-empty" class="ml-3 block text-sm font-medium">Leave Empty (Advanced)</label> </div> <p id="guardrail-warning" class="hidden text-sm text-yellow-400 mt-1"><strong>Warning:</strong> Leaving this empty will result in a constitution with NO guardrail script. This is an advanced option. Ensure you understand the consequences.</p> </div></div>`; break; case 'hard-fork': specificFields = `<div class="flex gap-4"><input type="number" name="majorVer" required class="w-1/2 ${inputClasses}" placeholder="Major Version"><input type="number" name="minorVer" required class="w-1/2 ${inputClasses}" placeholder="Minor Version"></div>`; break; case 'parameter-change': specificFields = `<div class="flex gap-4"><input type="text" name="paramKey" required class="w-1/2 ${inputClasses}" placeholder="Parameter Key (e.g., txFeePerByte)"><input type="text" name="paramValue" required class="w-1/2 ${inputClasses}" placeholder="New Value"></div>`; break; case 'treasury-withdrawal': specificFields = `<div id="withdrawal-recipients-container" class="space-y-2"><div class="flex gap-4 withdrawal-recipient"><input type="text" name="recipientAddr1" required class="w-2/3 ${inputClasses}" placeholder="Recipient Reward Address (bech32)"><input type="number" name="recipientAmount1" required class="w-1/3 ${inputClasses}" placeholder="Amount (ADA)"></div></div><button type="button" id="add-recipient-btn" class="text-sm text-orange-400 hover:underline">+ Add another recipient</button>`; break; case 'info': specificFields = `<div class="space-y-4">
            <label for="info-action-type" class="block text-sm font-medium">Purpose of this Info Action (Optional)</label>
            <select id="info-action-type" name="infoActionType" class="${inputClasses}">
                <option value="general">General Info Action</option>
                <option value="budget">Budget</option>
                <option value="ncl">Net Change Limit</option>
            </select>
            <div id="info-desc-general" class="p-3 text-sm rounded-lg" style="background-color: var(--input-bg);">
                For a general poll, clearly state the question and any options in your metadata (e.g., in the Rationale section) to gauge community sentiment effectively.
            </div>
            <div id="info-desc-budget" class="hidden p-3 text-sm rounded-lg" style="background-color: var(--input-bg);">
                <b>Guidance for Budget Proposals:</b> Your metadata should clearly define the budget's scope, the period it covers (e.g., 73 epochs), designated administrators, and an allocation for independent audits. This Info Action serves to get community approval before submitting withdrawals.
            </div>
            <div id="info-desc-ncl" class="hidden p-3 text-sm rounded-lg" style="background-color: var(--input-bg);">
                <b>Guidance for Net Change Limit:</b> Use the metadata to propose a net change limit for the treasury. Clearly state the limit and the period it applies to.
            </div>
        </div>`; break; } 
        
        let txGenHtml = `
            <div id="tx-gen-question" class="mt-8">
                 <p class="mb-4">Do you want to generate the CLI commands to build and submit this action as a transaction?</p>
                <div class="flex items-center space-x-6 mb-4">
                    <div class="flex items-center">
                        <input id="generate-tx-yes" name="generate-tx" type="radio" value="yes" class="h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300">
                        <label for="generate-tx-yes" class="ml-3 block text-sm font-medium">Yes</label>
                    </div>
                    <div class="flex items-center">
                        <input id="generate-tx-no" name="generate-tx" type="radio" value="no" class="h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300" checked>
                        <label for="generate-tx-no" class="ml-3 block text-sm font-medium">No</label>
                    </div>
                </div>
            </div>`;

        let formHtml = `
            <div id="transaction-form-container" class="hidden">
                 <p class="text-gray-300 mb-4 text-sm">This generates the command to create the governance action file. You will still need to build, sign, and submit the final transaction.</p>
                 <form id="transaction-form" class="space-y-4">
                    <input type="url" name="metadataUrl" required class="${inputClasses}" placeholder="Paste Metadata URL from Step 2 here">
                    <input type="text" name="depositAddress" required class="${inputClasses}" placeholder="Your Deposit Return Address (stake key file name)">
                    ${specificFields}
                    <button type="button" id="build-transaction-btn" class="btn-primary w-full font-bold py-2 px-4 rounded-lg transition-colors">Build Transaction Command</button>
                </form>
                <div id="transaction-output-container" class="hidden mt-4">
                    <div class="relative p-4 rounded-lg" style="background-color: var(--code-bg);">
                        <button class="copy-btn absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-xs px-2 py-1 rounded font-semibold text-white">Copy</button>
                        <pre><code id="transaction-output"></code></pre>
                    </div>
                </div>
            </div>`;

        return `<div id="step-3" class="step"><div><h3 class="text-xl font-semibold mb-4">Build Transaction Command</h3>${txGenHtml}${formHtml}</div></div>`;
    };
        
        createProposalButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                currentActionType = e.target.dataset.actionType;
                if (proposalModal) {
                    modalTitle.textContent = `Create: ${e.target.dataset.actionName}`;
                    modalBody.innerHTML = `<div class="step-indicator">${getStep1HTML()}${getStep2HTML()}${getStep3HTML(currentActionType)}</div>`;
                    proposalModal.classList.remove('hidden');
                }

                document.getElementById('generate-metadata-btn').addEventListener('click', generateMetadata);
                
                // Add listeners for Step 3
                const radioYes = document.getElementById('generate-tx-yes');
                if (radioYes) {
                    radioYes.addEventListener('change', () => {
                        if (radioYes.checked) {
                            disclaimerModal.classList.remove('hidden');
                        }
                    });
                }
                
                const radioNo = document.getElementById('generate-tx-no');
                if (radioNo) {
                    radioNo.addEventListener('change', () => {
                         if(radioNo.checked){
                             document.getElementById('transaction-form-container').classList.add('hidden');
                         }
                    })
                }
                
                if (currentActionType === 'info') {
                    const selector = document.getElementById('info-action-type');
                    const generalDesc = document.getElementById('info-desc-general');
                    const budgetDesc = document.getElementById('info-desc-budget');
                    const nclDesc = document.getElementById('info-desc-ncl');
                    
                    if(selector){
                        selector.addEventListener('change', (e) => {
                            generalDesc.classList.add('hidden');
                            budgetDesc.classList.add('hidden');
                            nclDesc.classList.add('hidden');
                            
                            if (e.target.value === 'general') {
                                generalDesc.classList.remove('hidden');
                            } else if (e.target.value === 'budget') {
                                budgetDesc.classList.remove('hidden');
                            } else if (e.target.value === 'ncl') {
                                nclDesc.classList.remove('hidden');
                            }
                        });
                    }
                }

                if (currentActionType === 'treasury-withdrawal') {
                    let recipientCount = 1;
                    const addRecipientBtn = document.getElementById('add-recipient-btn');
                    if(addRecipientBtn) {
                        addRecipientBtn.addEventListener('click', () => { 
                            recipientCount++; 
                            const container = document.getElementById('withdrawal-recipients-container'); 
                            const newRecipient = document.createElement('div'); 
                            newRecipient.className = 'flex gap-4 withdrawal-recipient'; 
                            newRecipient.innerHTML = `<input type="text" name="recipientAddr${recipientCount}" required class="w-2/3 input-styled rounded-lg px-4 py-2" placeholder="Recipient Reward Address ${recipientCount}"><input type="number" name="recipientAmount${recipientCount}" required class="w-1/3 input-styled rounded-lg px-4 py-2" placeholder="Amount (ADA)">`; 
                            container.appendChild(newRecipient); 
                        });
                    }
                }
                
                if (currentActionType === 'update-committee') {
                    const inputClasses = "w-full input-styled rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus-ring-accent";
                    const removeContainer = document.getElementById('remove-members-container');
                    const addContainer = document.getElementById('add-members-container');

                    document.getElementById('add-remove-member-btn').addEventListener('click', () => {
                        const newRemoveMember = document.createElement('div');
                        newRemoveMember.className = 'flex items-center gap-2 dynamic-row';
                        newRemoveMember.innerHTML = `
                            <input type="text" name="removeMemberVkey" class="${inputClasses}" placeholder="Cold VKey file name to remove">
                            <button type="button" class="remove-row-btn text-red-400 hover:text-red-600 font-bold text-xl p-1 leading-none">&times;</button>
                        `;
                        removeContainer.appendChild(newRemoveMember);
                    });

                    document.getElementById('add-add-member-btn').addEventListener('click', () => {
                        const newAddMember = document.createElement('div');
                        newAddMember.className = 'flex items-center gap-4 dynamic-row';
                        newAddMember.innerHTML = `
                            <input type="text" name="addMemberVkey" class="flex-grow ${inputClasses}" placeholder="Cold VKey file name to add">
                            <input type="number" name="addMemberEpoch" class="w-1/3 ${inputClasses}" placeholder="Term Epoch">
                            <button type="button" class="remove-row-btn text-red-400 hover:text-red-600 font-bold text-xl p-1 leading-none">&times;</button>
                        `;
                        addContainer.appendChild(newAddMember);
                    });
                }
                
                 if (currentActionType === 'new-constitution') {
                    const hashInput = document.getElementById('guardrailScriptHash-input');
                    const emptyCheckbox = document.getElementById('guardrail-empty');
                    const warning = document.getElementById('guardrail-warning');
                    
                    if(emptyCheckbox) {
                        emptyCheckbox.addEventListener('change', (e) => {
                            if (e.target.checked) {
                                hashInput.value = '';
                                hashInput.disabled = true;
                                hashInput.classList.add('opacity-50');
                                warning.classList.remove('hidden');
                            } else {
                                hashInput.disabled = false;
                                hashInput.classList.remove('opacity-50');
                                warning.classList.add('hidden');
                            }
                        });
                    }
                 }
            });
        });

        if (closeModalButton) {
            closeModalButton.addEventListener('click', () => {
                if (proposalModal) {
                    proposalModal.classList.add('hidden');
                }
            });
        }
        
        if(disclaimerAgreeBtn){
             disclaimerAgreeBtn.addEventListener('click', () => {
                 disclaimerModal.classList.add('hidden');
                 const txFormContainer = document.getElementById('transaction-form-container');
                 if(txFormContainer){
                     txFormContainer.classList.remove('hidden');
                     document.getElementById('build-transaction-btn').addEventListener('click', buildTransaction);
                 }
             });
        }
        
        if(disclaimerCancelBtn){
            disclaimerCancelBtn.addEventListener('click', () => {
                disclaimerModal.classList.add('hidden');
                const radioNo = document.getElementById('generate-tx-no');
                if(radioNo) radioNo.checked = true;
                const txFormContainer = document.getElementById('transaction-form-container');
                 if(txFormContainer){
                     txFormContainer.classList.add('hidden');
                 }
            });
        }

        if (proposalModal) {
             proposalModal.addEventListener('click', (e) => {
                 if (e.target === proposalModal) {
                     proposalModal.classList.add('hidden');
                 }
             });
        }
        
        // Delegated event listener for dynamic elements
        document.body.addEventListener('click', (e) => {
            if (e.target && e.target.classList.contains('remove-row-btn')) {
                const row = e.target.closest('.dynamic-row');
                if (row) {
                    row.remove();
                }
            }
             if (e.target && e.target.classList.contains('copy-btn')) {
                 const codeElement = e.target.closest('.relative').querySelector('code');
                 copyToClipboard(codeElement.innerText, e.target);
             }
        });

        // --- EXAMPLES PAGE LOGIC ---
        const accordionContainer = document.getElementById('examples-accordion');

        const renderExamples = () => {
            if(!accordionContainer) return;
            accordionContainer.innerHTML = '';
            const orderedTitles = [
                'New Constitution',
                'Hard Fork Initiation',
                'Protocol Parameters',
                'Treasury Withdrawal',
                'Motion of No-Confidence',
                'Update Committee / Threshold',
                'Info Action'
            ];

            orderedTitles.forEach(title => {
                if (examplesData[title]) {
                    const data = JSON.parse(JSON.stringify(examplesData[title]));
                    data.action = data.action.replace(/##NETWORK##/g, currentNetwork);
                    data.build = data.build.replace(/##NETWORK##/g, currentNetwork);
                    data.sign = data.sign.replace(/##NETWORK##/g, currentNetwork);
                    data.submit = data.submit.replace(/##NETWORK##/g, currentNetwork);
                    accordionContainer.innerHTML += createExampleHTML(title, data);
                }
            });
        };

        const createExampleHTML = (title, data) => {
            return `
                <div class="card-bg rounded-lg overflow-hidden">
                    <button class="accordion-button w-full text-left p-4 hover:bg-white/5 transition-colors flex justify-between items-center">
                        <span class="text-xl font-bold">${title}</span>
                        <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content">
                        <div class="p-6 space-y-6 border-t border-white/10">
                            <div>
                                <h4 class="font-semibold text-lg mb-2 text-accent">Metadata JSON</h4>
                                <div class="relative p-4 rounded-lg" style="background-color: var(--code-bg);">
                                    <button class="copy-btn absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-xs px-2 py-1 rounded font-semibold text-white">Copy</button>
                                    <pre><code class="language-json">${data.metadata}</code></pre>
                                </div>
                            </div>
                             <div>
                                <h4 class="font-semibold text-lg mb-2 text-accent">1. Create Action File</h4>
                                <div class="relative p-4 rounded-lg" style="background-color: var(--code-bg);">
                                    <button class="copy-btn absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-xs px-2 py-1 rounded font-semibold text-white">Copy</button>
                                    <pre><code class="language-bash">${data.action}</code></pre>
                                </div>
                            </div>
                             <div>
                                <h4 class="font-semibold text-lg mb-2 text-accent">2. Build Transaction</h4>
                                <div class="relative p-4 rounded-lg" style="background-color: var(--code-bg);">
                                    <button class="copy-btn absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-xs px-2 py-1 rounded font-semibold text-white">Copy</button>
                                    <pre><code class="language-bash">${data.build}</code></pre>
                                </div>
                            </div>
                             <div>
                                <h4 class="font-semibold text-lg mb-2 text-accent">3. Sign Transaction</h4>
                                <div class="relative p-4 rounded-lg" style="background-color: var(--code-bg);">
                                    <button class="copy-btn absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-xs px-2 py-1 rounded font-semibold text-white">Copy</button>
                                    <pre><code class="language-bash">${data.sign}</code></pre>
                                </div>
                            </div>
                             <div>
                                <h4 class="font-semibold text-lg mb-2 text-accent">4. Submit Transaction</h4>
                                <div class="relative p-4 rounded-lg" style="background-color: var(--code-bg);">
                                    <button class="copy-btn absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-xs px-2 py-1 rounded font-semibold text-white">Copy</button>
                                    <pre><code class="language-bash">${data.submit}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };
        
        // Accordion click listener
        if (accordionContainer) {
            accordionContainer.addEventListener('click', (e) => {
                const button = e.target.closest('.accordion-button');
                if (!button) return;

                const content = button.nextElementSibling;
                const icon = button.querySelector('svg');

                const isExpanded = content.style.maxHeight;

                // Close all other accordions
                accordionContainer.querySelectorAll('.accordion-content').forEach(otherContent => {
                    otherContent.style.maxHeight = null;
                });
                accordionContainer.querySelectorAll('.accordion-button svg').forEach(otherIcon => {
                    otherIcon.classList.remove('rotate-180');
                });


                // Toggle current accordion
                if (isExpanded) {
                    content.style.maxHeight = null;
                    icon.classList.remove('rotate-180');
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                    icon.classList.add('rotate-180');
                }
            });
        }


        // --- SCROLL LOGIC FOR HEADER ---
        let lastScrollTop = 0;
        const header = document.getElementById('main-header');
        window.addEventListener('scroll', function() {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if (scrollTop > lastScrollTop && scrollTop > header.offsetHeight) {
                // Downscroll
                header.classList.add('header-hidden');
            } else {
                // Upscroll
                header.classList.remove('header-hidden');
            }
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; 
        }, false);

        // --- THEME TOGGLE LOGIC ---
        const themeToggle = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('theme-icon-light');
        const darkIcon = document.getElementById('theme-icon-dark');

        const applyTheme = (theme) => {
            if (theme === 'light') {
                document.body.classList.add('light-mode');
                lightIcon.classList.remove('hidden');
                darkIcon.classList.add('hidden');
            } else {
                document.body.classList.remove('light-mode');
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
            }
        };

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.body.classList.contains('light-mode') ? 'light' : 'dark';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });

        // Apply theme on initial load
        applyTheme(localStorage.getItem('theme') || 'dark');

    </script>
</body>
</html>
